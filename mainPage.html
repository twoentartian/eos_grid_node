<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" content="text/html">
    <title>Eos Grid Simulation</title>
    <script src='lib/vue.js'></script>
    <script src='lib/echarts.js'></script>
</head>


<body onUnload="pageClose()" background="res/backgroundStar.png" style="background-size: auto">

<style>
    html, body {
        width: 1920px;
        height: 1080px
    }
    #rect1 {
        fill: rgba(255, 255, 255, 0.06);
        border-radius: 10px;
        border-width: 1px;
        fill-opacity: 40;
    }
    #rect2 {
        fill: rgba(255, 255, 255, 0.06);
        border-radius: 10px;
        border-width: 1px;
        fill-opacity: 100;
    }

    #rect3 {
        fill: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        border-width: 1px;
        fill-opacity: 10;
    }

    #path {
        fill: rgba(255, 255, 255, 1);
        border: 1px solid #FFFFFF;
        opacity: 0.3;
        stroke-width: 2px;
    }

    #textEnergySourceTypeGrid {
        position: absolute;
        font-size: 20px;
        color: rgba(255, 255, 255, 0.6);
        text-align: right;
        letter-spacing: 0
    }

    #textEnergySourceTypeSolar {
        position: absolute;
        font-size: 20px;
        color: rgba(255, 255, 255, 0.6);
        text-align: right;
        letter-spacing: 0
    }

    #textEnergySourceTypeWind {
        position: absolute;
        font-size: 20px;
        color: rgba(255, 255, 255, 0.6);
        text-align: right;
        letter-spacing: 0
    }

    #textEnergyValueTypeGrid {
        position: absolute;
        font-size: 36px;
        color: rgba(255, 255, 255, 1);
        text-align: right;
        letter-spacing: 0;
        font-family: DS-Digital-BoldItalic;
    }

    #textEnergyValueTypeSolar {
        position: absolute;
        font-size: 36px;
        color: rgba(255, 255, 255, 1);
        text-align: right;
        letter-spacing: 0;
        font-family: DS-Digital-BoldItalic;
    }

    #textEnergyValueTypeWind {
        position: absolute;
        font-size: 36px;
        color: rgba(255, 255, 255, 1);
        text-align: right;
        letter-spacing: 0;
        font-family: DS-Digital-BoldItalic;
    }

</style>

<svg xmlns="http://www.w3.org/2000/svg" width="1920" height="1080" x="0" y="0" id="appSvg"
     style="position: absolute; left: 0;top: 0;">
    <!--Grid Outer rect 1-->
    <!--<rect width="410" height="210" x="60" y="40" rx = "10" ry = "10" id="rect1">
    </rect>
    <!--Grid Outer rect 2-->
    <!--<rect width="390" height="190" x="70" y="50" rx = "10" ry = "10" id="rect2">
    </rect>
    <!--Grid Outer rect 3-->
    <rect width="180" height="150" x="90" y="70" rx="10" ry="10" id="rect3">
    </rect>

    <!--Solar Outer rect 1-->
    <!--<rect width="410" height="210" x="510" y="40" rx = "10" ry = "10" id="rect1">
    </rect>
    <!--Solar Outer rect 2-->
    <!--<rect width="390" height="190" x="520" y="50" rx = "10" ry = "10" id="rect2">
    </rect>
    <!--Solar Outer rect 3-->
    <rect width="180" height="150" x="540" y="70" rx="10" ry="10" id="rect3">
    </rect>

    <!--Wind Outer rect 1-->
    <!--<rect width="410" height="210" x="960" y="40" rx = "10" ry = "10" id="rect1">
    </rect>
    <!--Wind Outer rect 2-->
    <!--<rect width="390" height="190" x="970" y="50" rx = "10" ry = "10" id="rect2">
    </rect>
    <!--Wind Outer rect 3-->
    <rect width="180" height="150" x="990" y="70" rx="10" ry="10" id="rect3">
    </rect>

    <!--Battery 0 level-->
    <rect width="40" height="70" x="195" y="431" opacity="50%" rx="2" ry="2"
          style="fill:rgba(255,255,255,0.5);border-radius: 2px">
    </rect>
	<!--Battery 1 level-->
	<rect width="40" height="70" x="285" y="431" opacity="50%" rx="2" ry="2"
	      style="fill:rgba(255,255,255,0.5);border-radius: 2px">
	</rect>
	<!--Battery 2 level-->
	<rect width="40" height="70" x="375" y="431" opacity="50%" rx="2" ry="2"
	      style="fill:rgba(255,255,255,0.5);border-radius: 2px">
	</rect>
	<!--Battery 3 level-->
	<rect width="40" height="70" x="465" y="431" opacity="50%" rx="2" ry="2"
	      style="fill:rgba(255,255,255,0.5);border-radius: 2px">
	</rect>
	<!--Battery 4 level-->
	<rect width="40" height="70" x="555" y="431" opacity="50%" rx="2" ry="2"
	      style="fill:rgba(255,255,255,0.5);border-radius: 2px">
	</rect>
	<!--Battery 5 level-->
	<rect width="40" height="70" x="645" y="431" opacity="50%" rx="2" ry="2"
	      style="fill:rgba(255,255,255,0.5);border-radius: 2px">
	</rect>
	<!--Battery 6 level-->
	<rect width="40" height="70" x="875" y="431" opacity="50%" rx="2" ry="2"
	      style="fill:rgba(255,255,255,0.5);border-radius: 2px">
	</rect>
	<!--Battery 7 level-->
	<rect width="40" height="70" x="965" y="431" opacity="50%" rx="2" ry="2"
	      style="fill:rgba(255,255,255,0.5);border-radius: 2px">
	</rect>
	<!--Battery 8 level-->
	<rect width="40" height="70" x="1195" y="431" opacity="50%" rx="2" ry="2"
	      style="fill:rgba(255,255,255,0.5);border-radius: 2px">
	</rect>

    <!--Background right-->
    <rect width="450" height="1000" x="1410" y="40" opacity="60%" rx="10" ry="10"
          style="fill:rgba(255,255,255,0.06);border-radius: 10px">
    </rect>

    <!--Path vertical 3-->
    <path d="M259 250 L259 356 L261 356 L261 250 L259 250 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M715 250 L715 356 L717 356 L717 250 L715 250 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M1165 250 L1165 356 L1167 356 L1167 250 L1165 250 Z" id="path" style="border: 1px solid #FFFFFF"></path>

	<!--Path vertical 9-->
	<path d="M215 356 L215 397 L217 397 L217 356 L215 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M304 356 L304 397 L306 397 L306 356 L304 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M394 356 L394 397 L396 397 L396 356 L394 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M484 356 L484 397 L486 397 L486 356 L484 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M574 356 L574 397 L576 397 L576 356 L574 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M664 356 L664 397 L666 397 L666 356 L664 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>

	<path d="M894 356 L894 397 L896 397 L896 356 L894 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M984 356 L984 397 L986 397 L986 356 L984 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M1214 356 L1214 397 L1216 397 L1216 356 L1214 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>

	<!--Path horizontal 9-->
	<path d="M215 356 L215 358 L665 358 L665 356 L215 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M715 356 L715 358 L985 358 L985 356 L715 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M1165 356 L1165 358 L1215 358 L1215 356 L1165 356 Z" id="path" style="border: 1px solid #FFFFFF"></path>

	<!--Path horizontal lower part-->
	<path d="M714 601 L714 642 L716 642 L716 601 L714 601 Z" id="path" style="border: 1px solid #FFFFFF"></path>

	<path d="M300 642 L300 736 L302 736 L302 642 L300 642 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M509 642 L509 682 L511 682 L511 642 L509 642 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M714 642 L714 765 L716 765 L716 642 L714 642 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M929 642 L929 682 L931 682 L931 642 L929 642 Z" id="path" style="border: 1px solid #FFFFFF"></path>
	<path d="M1130 642 L1130 736 L1132 736 L1132 642 L1130 642 Z" id="path" style="border: 1px solid #FFFFFF"></path>

	<path d="M300 642 L1130 642 L1130 644 L300 644 L300 642 Z" id="path" style="border: 1px solid #FFFFFF"></path>
</svg>

<div>
    <p style="left: 350px;top: 80px;width: 80px;height: 28px;" id="textEnergySourceTypeGrid">
        公共电网
    </p>

    <p style="left: 820px;top: 80px;width: 60px;height: 28px;" id="textEnergySourceTypeSolar">
        太阳能
    </p>

    <p style="left: 1290px;top: 80px;width: 40px;height: 28px;" id="textEnergySourceTypeWind">
        风能
    </p>

    <p style="left: 313px; top: 120px; width: 117px;height: 36px;" id="textEnergyValueTypeGrid">
        {{reading}}
    </p>

    <p style="left: 760px; top: 120px; width: 117px;height: 36px;" id="textEnergyValueTypeSolar">
	    {{reading}}
    </p>

    <p style="left: 1210px; top: 120px; width: 117px;height: 36px;" id="textEnergyValueTypeWind">
	    {{reading}}
    </p>

    <!--House readings-->
    <p style="left: 261px; top: 713px; width: 80px;height: 24px;
        position: absolute;
        font-size: 20px;
        color: rgba(255, 255, 255, 1);
        text-align: center;
        letter-spacing: 0;" id="home0">
        home11<br>{{reading}}
    </p>
    <p style="left: 477px; top: 663px; width: 80px;height: 24px;
        position: absolute;
        font-size: 20px;
        color: rgba(255, 255, 255, 1);
        text-align: center;
        letter-spacing: 0;" id="home1">
	    home12<br>{{reading}}
    </p>
    <p style="left: 681px; top: 742px; width: 80px;height: 24px;
        position: absolute;
        font-size: 20px;
        color: rgba(255, 255, 255, 1);
        text-align: center;
        letter-spacing: 0;" id="home2">
	    home13<br>{{reading}}
    </p>
    <p style="left: 888px; top: 662px; width: 80px;height: 24px;
        position: absolute;
        font-size: 20px;
        color: rgba(255, 255, 255, 1);
        text-align: center;
        letter-spacing: 0;" id="home3">
	    home14<br>{{reading}}
    </p>
    <p style="left: 1096px; top: 713px; width: 80px;height: 24px;
        position: absolute;
        font-size: 20px;
        color: rgba(255, 255, 255, 1);
        text-align: center;
        letter-spacing: 0;" id="home4">
	    home15<br>{{reading}}
    </p>

</div>


<!--Grid rect-->
<img src="res/backgroundRect.png" width="412" height="211"
     style="position: absolute; left: 60px; top: 40px; opacity: 40%">

<!--Solar rect-->
<img src="res/backgroundRect.png" width="412" height="211"
     style="position: absolute; left: 510px; top: 40px; opacity: 40%">

<!--Wind rect-->
<img src="res/backgroundRect.png" width="412" height="211"
     style="position: absolute; left: 960px; top: 40px; opacity: 40%">

<!--Grid-->
<img src="res/grid.svg" width="60" height="120" style="position: absolute; left: 150px; top: 85px; opacity: 60%">

<!--Solar-->
<img src="res/solar.svg" width="120" height="95" style="position: absolute; left: 570px; top: 98px; opacity: 60%">

<!--Wind-->
<img src="res/wind.svg" width="118" height="104" style="position: absolute; left: 1021px; top: 94px; opacity: 60%">

<!--Battery 0-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 190px; top: 418px; opacity: 50%">

<!--Battery 1-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 280px; top: 418px; opacity: 50%">

<!--Battery 2-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 370px; top: 418px; opacity: 50%">

<!--Battery 3-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 460px; top: 418px; opacity: 50%">

<!--Battery 4-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 550px; top: 418px; opacity: 50%">

<!--Battery 5-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 640px; top: 418px; opacity: 50%">

<!--Battery 6 (solar)-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 870px; top: 418px; opacity: 50%">

<!--Battery 7 (solar)-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 960px; top: 418px; opacity: 50%">

<!--Battery 8 (wind)-->
<img src="res/battery.svg" width="50" height="88" style="position: absolute; left: 1190px; top: 418px; opacity: 50%">

<!--Background Battery-->
<img src="res/backgroundBattery.png" width="1312" height="151"
     style="position: absolute; left: 60px; top: 450px; opacity: 100%">

<!--Background House-->
<img src="res/backgroundEclipse.png" width="1312" height="320"
     style="position: absolute; left: 60px; top: 760px; opacity: 50%">

<!--House 1-->
<img src="res/house.svg" width="160" height="136" style="position: absolute; left: 205px; top: 808px;">
<img src="res/house_holder_png.png" width="250" height="63" style="position: absolute; left: 165px; top: 907px;">

<!--House 2-->
<img src="res/house.svg" width="160" height="136" style="position: absolute; left: 431px; top: 757px;">
<img src="res/house_holder_png.png" width="250" height="63" style="position: absolute; left: 391px; top: 841px;">

<!--House 3-->
<img src="res/house.svg" width="160" height="136" style="position: absolute; left: 625px; top: 837px;">
<img src="res/house_holder_png.png" width="250" height="63" style="position: absolute; left: 585px; top: 950px;">

<!--House 4-->
<img src="res/house.svg" width="160" height="136" style="position: absolute; left: 842px; top: 757px;">
<img src="res/house_holder_png.png" width="250" height="63" style="position: absolute; left: 802px; top: 841px;">

<!--House 5-->
<img src="res/house.svg" width="160" height="136" style="position: absolute; left: 1040px; top: 808px;">
<img src="res/house_holder_png.png" width="250" height="63" style="position: absolute; left: 1000px; top: 907px;">

<div id="echart_line" style="width: 390px;height:250px;color: #FFFFFF;position: absolute ;left: 1440px; top: 348px;">

</div>

<div id="echart_pie1" style="width: 160px;height:160px;color: #FFFFFF;position: absolute ;left: 1460px; top: 138px;">

</div>

<div id="echart_pie2" style="width: 160px;height:160px;color: #FFFFFF;position: absolute ;left: 1660px; top: 138px;">

</div>

<table id="table" style="width: 390px; height: 250px;position: absolute;left: 1460px;top: 707px; color: rgba(255,255,255,0.6)">
    <tr>
        <td>用户</td>
        <td>购买量</td>
        <td>价格</td>
        <td>时间</td>
    </tr>
	<tr>
		<td>{{user0}}</td>
		<td>{{amount0}}</td>
		<td>{{price0}}</td>
		<td>{{time0}}</td>
	</tr>
    <tr>
        <td>{{user1}}</td>
        <td>{{amount1}}</td>
        <td>{{price1}}</td>
        <td>{{time1}}</td>
    </tr>
	<tr>
		<td>{{user2}}</td>
		<td>{{amount2}}</td>
		<td>{{price2}}</td>
		<td>{{time2}}</td>
	</tr>
	<tr>
		<td>{{user3}}</td>
		<td>{{amount3}}</td>
		<td>{{price3}}</td>
		<td>{{time3}}</td>
	</tr>
	<tr>
		<td>{{user4}}</td>
		<td>{{amount4}}</td>
		<td>{{price4}}</td>
		<td>{{time4}}</td>
	</tr>
	<tr>
		<td>{{user5}}</td>
		<td>{{amount5}}</td>
		<td>{{price5}}</td>
		<td>{{time5}}</td>
	</tr>
	<tr>
		<td>{{user6}}</td>
		<td>{{amount6}}</td>
		<td>{{price6}}</td>
		<td>{{time6}}</td>
	</tr>
</table>

<script type="text/javascript">
	//Readings
	let vueGridReadings = new Vue({
		el: '#textEnergyValueTypeGrid',
		data: {
			reading : 0,
		}
	});
	let vueSolarReadings = new Vue({
		el: '#textEnergyValueTypeSolar',
		data: {
			reading : 0,
		}
	});
	let vueWindReadings = new Vue({
		el: '#textEnergyValueTypeWind',
		data: {
			reading : 0,
		}
	});
	let vueHome0Readings = new Vue({
		el: '#home0',
		data: {
			reading : 0,
		}
	});
	let vueHome1Readings = new Vue({
		el: '#home1',
		data: {
			reading : 0,
		}
	});
	let vueHome2Readings = new Vue({
		el: '#home2',
		data: {
			reading : 0,
		}
	});
	let vueHome3Readings = new Vue({
		el: '#home3',
		data: {
			reading : 0,
		}
	});
	let vueHome4Readings = new Vue({
		el: '#home4',
		data: {
			reading : 0,
		}
	});
	function UpdateReadings(grid,solar,wind,home0,home1,home2,home3,home4){
		vueGridReadings.reading = grid;
		vueSolarReadings.reading = solar;
		vueWindReadings.reading = wind;

		vueHome0Readings.reading = home0;
		vueHome1Readings.reading = home1;
		vueHome2Readings.reading = home2;
		vueHome3Readings.reading = home3;
		vueHome4Readings.reading = home4;
	}

	//Table
	let vm = new Vue({
		el: '#table',
		data: {
			user0 : 'user0',
			user1 : 'user1',
			user2 : 'user2',
			user3 : 'user3',
			user4 : 'user4',
			user5 : 'user5',
			user6 : 'user6',
			amount0 : 'amount0',
			amount1 : 'amount1',
			amount2 : 'amount2',
			amount3 : 'amount3',
			amount4 : 'amount4',
			amount5 : 'amount5',
			amount6 : 'amount6',
			price0 : 'price0',
			price1 : 'price1',
			price2 : 'price2',
			price3 : 'price3',
			price4 : 'price4',
			price5 : 'price5',
			price6 : 'price6',
			time0 : 'time0',
			time1 : 'time1',
			time2 : 'time2',
			time3 : 'time3',
			time4 : 'time4',
			time5 : 'time5',
			time6 : 'time6',
		}
	});
	function UpdateTable(user,amount,price){
		vm.user6 = vm.user5;vm.amount6 = vm.amount5;vm.price6 = vm.price5;vm.time6 = vm.time5;
		vm.user5 = vm.user4;vm.amount5 = vm.amount4;vm.price5 = vm.price4;vm.time5 = vm.time4;
		vm.user4 = vm.user3;vm.amount4 = vm.amount3;vm.price4 = vm.price3;vm.time4 = vm.time3;
		vm.user3 = vm.user2;vm.amount3 = vm.amount2;vm.price3 = vm.price2;vm.time3 = vm.time2;
		vm.user2 = vm.user1;vm.amount2 = vm.amount1;vm.price2 = vm.price1;vm.time2 = vm.time1;
		vm.user1 = vm.user0;vm.amount1 = vm.amount0;vm.price1 = vm.price0;vm.time1 = vm.time0;
		vm.user0 = user;vm.amount0 = amount;vm.price0 = price;let d=new Date();vm.time0 = d.getHours()+':'+d.getMinutes()+':'+d.getSeconds();
	}

	//Line chart
	let myLineChart = echarts.init(document.getElementById('echart_line'));
	let lineChartoption = {
		title: {
			text: '储能价格趋势',
            textStyle: {
				color: 'rgba(255,255,255,1)'
            }
		},
		tooltip: {},
		textStyle: {
			color: 'rgba(255,255,255,1)'
		},
		xAxis: {
			data: ["前5周期", "前4周期", "前3周期", "前2周期", "前1周期", "最新"],
		},
		yAxis: {
			max: '91',
			min: '90',
			type: 'value',
		},
		series: [{
			name: '价格',
			type: 'line',
			data: [90, 90, 90, 90, 90, 90]
		}]
	};
	myLineChart.setOption(lineChartoption);
	function UpdateLineChart(price){
		lineChartoption.series[0].data[0] = lineChartoption.series[0].data[1];
		lineChartoption.series[0].data[1] = lineChartoption.series[0].data[2];
		lineChartoption.series[0].data[2] = lineChartoption.series[0].data[3];
		lineChartoption.series[0].data[3] = lineChartoption.series[0].data[4];
		lineChartoption.series[0].data[4] = lineChartoption.series[0].data[5];
		lineChartoption.series[0].data[5] = price;
		myLineChart.setOption(lineChartoption);
	}

	//Pie chart
	let labelTop = {//上层样式
		normal : {
			color :'#FF8E3D',
			label : {
				show : true,
				position : 'center',
				formatter : '{b}',
				textStyle: {
					baseline : 'bottom',
					fontSize:18
				}
			},
			labelLine : {
				show : false
			}
		}
	};
	let labelBottom = {//底层样式
		normal : {
			color: '#99ccff',
			label : {
				show : true,
				position : 'center',
				fontSize:18
			},
			labelLine : {
				show : false
			}
		},
		emphasis: {//悬浮式样式
			color: 'rgba( 0,0,0,0)'
		}
	};
	let radius = [70,80];// 半径[内半径，外半径]
	let pieChartOption1 = {
		animation:false,
		tooltip : {         // 提示框. Can be overwrited by series or data
			trigger: 'axis',
			//show: true,   //default true
			showDelay: 0,
			hideDelay: 50,
			transitionDuration:0,
			borderRadius : 8,
			borderWidth: 2,
			padding: 10,    // [5, 10, 15, 20]
		},
		series : [
			{
				type : 'pie',
				center : ['50%', '50%'],//圆心坐标（div中的%比例）
				radius : radius,//半径
				x: '0%', // for funnel
				itemStyle : labelTop,//graphStyleA,//图形样式 // 当查到的数据不存在（并非为0），此属性隐藏
				data : [
					{name:'电池剩余能量', value:0,itemStyle : labelTop},
					{name:'0%', value:100, itemStyle : labelBottom}
				]
			}
		]
	};
	let pieChartOption2 = {
		animation:false,
		tooltip : {         // 提示框. Can be overwrited by series or data
			trigger: 'axis',
			//show: true,   //default true
			showDelay: 0,
			hideDelay: 50,
			transitionDuration:0,
			borderRadius : 8,
			borderWidth: 2,
			padding: 10,    // [5, 10, 15, 20]
		},
		series : [
			{
				type : 'pie',
				center : ['50%', '50%'],//圆心坐标（div中的%比例）
				radius : radius,//半径
				x: '0%', // for funnel
				itemStyle : labelTop,//graphStyleA,//图形样式 // 当查到的数据不存在（并非为0），此属性隐藏
				data : [
					{name:'绿色能源占比', value:0,itemStyle : labelTop},
					{name:'0%', value:100, itemStyle : labelBottom}
				]
			}
		]
	};
	let myPieChart1 = echarts.init(document.getElementById('echart_pie1'));
	let myPieChart2 = echarts.init(document.getElementById('echart_pie2'));
	myPieChart1.setOption(pieChartOption1);
	myPieChart2.setOption(pieChartOption2);




	// Web Socket
	let dataSocket = undefined;
	function pageClose() {
		dataSocket.close();
	}
	let webSocketAddress = 'ws://127.0.0.1:5556';
	if ("WebSocket" in window) {
		dataSocket = new WebSocket(webSocketAddress);
		dataSocket.onopen = function () {
			let requireDataIntervalId = setInterval(function () {
				if (dataSocket.readyState === 1) {
					let command = {};
					command['type'] = 'require';
					command['content'] = '';
					dataSocket.send(JSON.stringify(command));

					//TEST
					//command['type'] = 'changePrice';
					//command['content'] = 'home11 91';
					//dataSocket.send(JSON.stringify(command));
				}
			}, 3000);
		};
		dataSocket.onmessage = function (event) {
			let obj = JSON.parse(event.data);
			if (obj.type === 'require') {
				let community = obj.result.community;
				let market = obj.result.market;
				//Update Battery Info
				let batteryRatio = Math.round(community.battery[0].ratio.toFixed(2) * 100);
				pieChartOption1.series[0].data[0].value = batteryRatio;
				pieChartOption1.series[0].data[1].value = 100-batteryRatio;
				pieChartOption1.series[0].data[1].name = batteryRatio + '%';
				let cleanEnergyCount=0;
				for (let element in obj.result.community.homes) {
					cleanEnergyCount += obj.result.community.homes[element].cleanEnergy;
				}
				let cleanEnergyRatio = Math.round((cleanEnergyCount/community.battery[0].energy).toFixed(2)*100);
				if (cleanEnergyRatio > 100) cleanEnergyRatio=100;
				pieChartOption2.series[0].data[0].value = cleanEnergyRatio;
				pieChartOption2.series[0].data[1].value = 100-cleanEnergyRatio;
				pieChartOption2.series[0].data[1].name = cleanEnergyRatio + '%';
				myPieChart1.setOption(pieChartOption1);
				myPieChart2.setOption(pieChartOption2);

				//Update market info
				UpdateTable(market.latestSell.user,market.latestSell.amount,market.latestSell.price);

				//Update readings
				UpdateReadings(community.grid[0].meter.reading, community.generator[0].meter.reading, community.generator[1].meter.reading,
					community.homes['home11'].meter.reading,
					community.homes['home12'].meter.reading,
					community.homes['home13'].meter.reading,
					community.homes['home14'].meter.reading,
					community.homes['home15'].meter.reading);

				//Update line chart
				UpdateLineChart(market.latestSell.price);
			}
		};
		dataSocket.onclose = function () {
			vm.rawData = 'Closed';
		}
	}
	else {
		alert("Your browser does not support WebSocket");
	}


</script>

</body>
</html>
